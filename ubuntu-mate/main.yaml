---
- name: Provision localhost
  hosts: localhost
  connection: local
  vars:
    git_username:
    git_email:

  pre_tasks:
    - name: Update and upgrade apt system packages
      become: true
      apt:
        upgrade: "yes" # In addition to yes and no you can use dist, full, or safe, therefore it is a string
        update_cache: yes
    - name: Install additional packages
      become: true
      package:
        name:
          - emacs
          - fonts-powerline
          - gitk
  roles:
    - role: gantsign.oh-my-zsh
      oh_my_zsh_theme: agnoster
      oh_my_zsh_plugins:
        - git
      users:
        - username: "{{ ansible_env.USER }}"

  post_tasks:
    - name: Switch to zsh
      become: yes
      user:
        name: "{{ ansible_env.USER }}"
        shell: /usr/bin/zsh
    - name: Add git graph alias
      community.general.git_config:
        name: alias.graph
        scope: global
        value: 'log --graph --abbrev-commit --decorate --date=relative --date-order --format=format:"%C(bold blue)%h%C(reset) - %C(bold green)(%ar)%C(reset) %C(white)%s%C(reset) %C(yellow)- [%an]%C(reset)%C(auto)%d%C(reset)" --all'
    - name: Add git username
      community.general.git_config:
        name: user.name
        scope: global
        value: "{{ git_username }}"
    - name: Add git email
      community.general.git_config:
        name: user.email
        scope: global
        value: "{{ git_email }}"
    - name: Add user to virtualbox group
      become: true
      user:
        name: "{{ ansible_env.USER }}"
        groups:
          - vboxsf
        append: yes
